<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>You're Invited!</title>
    <!--
      Load Tailwind CSS for beautiful, responsive styling.
      We'll also use the "Playfair Display" font for elegant headings.
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /*
          Custom CSS for smooth transitions and a few key styles.
          We use a serif font for headers and a sans-serif for body text.
        */
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        .font-playfair {
            font-family: 'Playfair Display', serif;
        }

        /*
          This class will control the "book opening" effect.
          The transition gives a smooth animation when the classes are toggled.
        */
        #intro-screen {
            transition: opacity 1s ease-in-out, transform 1s ease-in-out;
        }

        /*
          This class is used to hide elements with a smooth fade-out.
        */
        .fade-out {
            opacity: 0;
            transform: translateY(-50px);
            pointer-events: none; /* Prevents user from clicking on the hidden element */
        }

        /*
          This class ensures smooth scrolling when navigating between sections.
        */
        html {
            scroll-behavior: smooth;
        }

        /*
          Custom styles for the image carousel.
        */
        .carousel-item {
            display: none;
            width: 100%;
        }
        .carousel-item.active {
            display: block;
        }
        
        /*
          Modal styles: The overlay covers the whole screen with a dark,
          semi-transparent background. The modal itself is centered.
        */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        
        .message-box {
            display: none; /* Initially hidden */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            text-align: center;
        }
        
        .message-box.success {
            background-color: #d1fae5; /* green-100 */
            color: #065f46; /* green-700 */
        }
        
        .message-box.error {
            background-color: #fee2e2; /* red-100 */
            color: #991b1b; /* red-700 */
        }
        
        .message-box.visible {
            display: block;
        }

    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!--
      Intro Screen: The "book cover" or opening page.
      This will be visible first and will fade out when the button is clicked.
    -->
    <div id="intro-screen" class="relative min-h-screen flex flex-col justify-center items-center text-center p-6 transition-all duration-1000 ease-in-out bg-cover bg-center" style="background-image: url('https://placehold.co/1080x1920/D8B4A0/ffffff?text=Wedding+Photo+Placeholder');">
        <div class="absolute inset-0 bg-black opacity-30"></div>
        <div class="relative z-10 text-white space-y-4">
            <h1 class="font-playfair text-5xl md:text-7xl font-bold leading-tight drop-shadow-lg">
                Emma & Liam
            </h1>
            <p class="text-xl md:text-2xl font-light tracking-wide">
                Cordially Invite You to Our Wedding
            </p>
            <p class="text-lg md:text-xl font-light">
                Sunday, December 28th, 2025
            </p>
            <button id="open-button" class="mt-8 px-8 py-3 bg-white text-gray-800 rounded-full shadow-lg hover:bg-gray-200 transition-colors duration-300 transform hover:scale-105">
                Open Invitation
            </button>
        </div>
    </div>

    <!--
      Main Content: This section will be hidden initially.
      It will become visible after the intro screen fades out.
    -->
    <div id="main-content" class="min-h-screen pt-12 pb-20 p-6 sm:px-12 md:px-24 hidden opacity-0">

        <!-- Header Section -->
        <header class="text-center mb-12">
            <h2 class="font-playfair text-4xl md:text-5xl font-bold mb-2">Emma & Liam</h2>
            <p class="text-lg text-gray-600">We joyfully request the pleasure of your company as we exchange vows and begin our new life together.</p>
        </header>

        <!-- Image Carousel Section -->
        <section class="mb-12">
            <div class="relative w-full h-80 overflow-hidden rounded-xl shadow-lg">
                <div id="carousel" class="flex transition-transform ease-in-out duration-700">
                    <img src="https://placehold.co/1080x600/F4EADF/000000?text=Placeholder+Image+1" alt="Wedding Photo 1" class="carousel-item active object-cover w-full h-full">
                    <img src="https://placehold.co/1080x600/E8D2C5/000000?text=Placeholder+Image+2" alt="Wedding Photo 2" class="carousel-item object-cover w-full h-full">
                    <img src="https://placehold.co/1080x600/C8A17A/000000?text=Placeholder+Image+3" alt="Wedding Photo 3" class="carousel-item object-cover w-full h-full">
                </div>
                <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">
                    <span class="dot w-2 h-2 bg-white rounded-full cursor-pointer opacity-50" onclick="currentSlide(0)"></span>
                    <span class="dot w-2 h-2 bg-white rounded-full cursor-pointer opacity-50" onclick="currentSlide(1)"></span>
                    <span class="dot w-2 h-2 bg-white rounded-full cursor-pointer opacity-50" onclick="currentSlide(2)"></span>
                </div>
            </div>
        </section>

        <!-- Wedding Details Section -->
        <section id="details" class="mb-12 text-center">
            <h3 class="font-playfair text-3xl font-bold mb-4">The Ceremony & Reception</h3>
            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-rose-400">
                <p class="text-2xl font-semibold mb-2">Sunday, December 28th, 2025</p>
                <p class="text-xl mb-4">4:00 PM</p>
                <p class="text-lg">The Grand Garden Venue</p>
                <p class="text-md text-gray-500 mb-6">123 Wedding Lane, Anytown, State 12345</p>
                 <!-- Countdown Timer is now part of this section -->
                <div id="countdown-timer" class="flex justify-center items-center space-x-4 text-xl sm:text-2xl font-bold text-rose-500">
                    <!-- Countdown content will be generated by JavaScript -->
                </div>
            </div>
        </section>
        
        <!--
          RSVP Section - This section is now visible on the main page.
          It contains a button that will trigger the pop-up form.
        -->
        <section id="rsvp-section" class="mb-12 text-center">
            <h3 class="font-playfair text-3xl font-bold mb-4">RSVP</h3>
            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-rose-400">
                <p class="text-md text-gray-700 mb-6">
                    Please let us know if you'll be able to join us for our special day.
                    We kindly ask you to respond by November 28th, 2025.
                </p>
                <button id="open-rsvp-button" class="px-8 py-3 bg-rose-500 text-white rounded-full shadow-lg hover:bg-rose-600 transition-colors duration-300 transform hover:scale-105">
                    Open RSVP Form
                </button>
            </div>
        </section>

        <!-- New Guestbook Section - Displays messages from guests -->
        <section id="guestbook-section" class="mb-12 text-center">
            <h3 class="font-playfair text-3xl font-bold mb-4">Guestbook</h3>
            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-rose-400">
                <p class="text-md text-gray-700 mb-6">
                    Please leave us a special message or well wishes as we start our new life together.
                </p>
                <!-- This is the scrollable list of guestbook entries -->
                <div id="guestbook-entries" class="h-64 overflow-y-auto p-4 bg-gray-100 rounded-lg shadow-inner mb-6 text-left space-y-4">
                    <!-- Guestbook entries will be dynamically inserted here -->
                </div>
                <button id="open-guestbook-form-button" class="mt-6 px-8 py-3 bg-rose-500 text-white rounded-full shadow-lg hover:bg-rose-600 transition-colors duration-300 transform hover:scale-105">
                    Write a Message
                </button>
            </div>
        </section>
        
        <!-- New Section for Venue Information -->
        <section id="venue-info" class="mb-12 text-center">
            <h3 class="font-playfair text-3xl font-bold mb-4">Venue Information</h3>
            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-rose-400 text-left space-y-4">
                <div class="flex items-start">
                    <span class="text-2xl mr-4">üöª</span>
                    <p class="text-md text-gray-700">
                        **Restrooms:** Located at the back of the main hall, on both the left and right sides.
                    </p>
                </div>
                <div class="flex items-start">
                    <span class="text-2xl mr-4">üôè</span>
                    <p class="text-md text-gray-700">
                        **Prayer Room:** A designated prayer room is available on the left side of the main hall, behind the reception area.
                    </p>
                </div>
                <div class="flex items-start">
                    <span class="text-2xl mr-4">üÖøÔ∏è</span>
                    <p class="text-md text-gray-700">
                        **Parking:** Ample parking is available in the lot surrounding the venue. Additional overflow parking can be found across the street.
                    </p>
                </div>
            </div>
        </section>

        <!-- New Section for Custom Text -->
        <section id="our-story" class="mb-12 text-center">
            <h3 class="font-playfair text-3xl font-bold mb-4">Our Story</h3>
            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-rose-400">
                <p class="text-md text-gray-700">
                    This is a space for you to write a special message to your guests. You can share your story, talk about how you met, or express your gratitude for their support. Simply edit this text to add your personal touch.
                </p>
            </div>
        </section>
        
        <!-- New Section for Creator Credits -->
        <section id="creator-credit" class="mb-12 text-center">
            <h3 class="font-playfair text-3xl font-bold mb-4">Credits</h3>
            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-rose-400">
                <p class="text-md text-gray-700">
                    This digital invitation was created with ‚ù§Ô∏è by Gemini.
                </p>
            </div>
        </section>

        <!--
          RSVP Form Content (Hidden to be used in the modal)
          This is the content that will be cloned and shown inside the pop-up.
        -->
        <div id="rsvp-form-modal-content" class="hidden">
            <h3 class="font-playfair text-3xl font-bold text-center mb-6">RSVP</h3>
            <div class="bg-white p-6 rounded-xl shadow-md">
                <form id="rsvp-form" class="space-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                        <input type="text" id="name" name="name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rose-300 focus:ring focus:ring-rose-200 focus:ring-opacity-50 p-2">
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                        <input type="tel" id="phone" name="phone" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rose-300 focus:ring focus:ring-rose-200 focus:ring-opacity-50 p-2">
                    </div>
                    <div>
                        <label for="attendance" class="block text-sm font-medium text-gray-700">Will you be attending?</label>
                        <select id="attendance" name="attendance" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rose-300 focus:ring focus:ring-rose-200 focus:ring-opacity-50 p-2">
                            <option value="">Please Select...</option>
                            <option value="yes">Joyfully Accepting</option>
                            <option value="no">Regretfully Declining</option>
                        </select>
                    </div>
                    <div>
                        <label for="adults" class="block text-sm font-medium text-gray-700">Number of Adults</label>
                        <input type="number" id="adults" name="adults" min="1" value="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rose-300 focus:ring focus:ring-rose-200 focus:ring-opacity-50 p-2">
                    </div>
                    <div>
                        <label for="children" class="block text-sm font-medium text-gray-700">Number of Children</label>
                        <input type="number" id="children" name="children" min="0" value="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rose-300 focus:ring focus:ring-rose-200 focus:ring-opacity-50 p-2">
                    </div>
                    <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-rose-500 hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rose-500 transition-colors duration-300">
                        Submit RSVP
                    </button>
                    <div id="rsvp-message" class="message-box"></div>
                </form>
                <p class="mt-4 text-xs text-gray-500 text-center">
                    *Only one person as a representative from each family needs to fill in this form.
                </p>
            </div>
        </div>
        
        <!--
          Guestbook Form Content (Hidden to be used in the modal)
          This is the content that will be cloned and shown inside the pop-up.
        -->
        <div id="guestbook-form-content" class="hidden">
            <h3 class="font-playfair text-3xl font-bold text-center mb-6">Leave a Wish</h3>
            <div class="bg-white p-6 rounded-xl shadow-md">
                <form id="guestbook-form" class="space-y-4">
                    <div>
                        <label for="guestbook-name" class="block text-sm font-medium text-gray-700">Your Name</label>
                        <input type="text" id="guestbook-name" name="name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rose-300 focus:ring focus:ring-rose-200 focus:ring-opacity-50 p-2">
                    </div>
                    <div>
                        <label for="guestbook-message" class="block text-sm font-medium text-gray-700">Your Message</label>
                        <textarea id="guestbook-message" name="message" rows="4" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rose-300 focus:ring focus:ring-rose-200 focus:ring-opacity-50 p-2"></textarea>
                    </div>
                    <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-rose-500 hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rose-500 transition-colors duration-300">
                        Submit Message
                    </button>
                    <div id="guestbook-message-status" class="message-box"></div>
                </form>
            </div>
        </div>

        <!-- Location Section (Hidden to be used in the modal) -->
        <div id="location-content" class="hidden">
            <h3 class="font-playfair text-3xl font-bold text-center mb-6">Our Location</h3>
            <div class="bg-white p-6 rounded-xl shadow-md">
                <p class="text-xl font-semibold mb-2">The Grand Garden Venue</p>
                <p class="text-md text-gray-700 mb-4">123 Wedding Lane, Anytown, State 12345</p>
                <!-- Placeholder for a map iframe. You can replace this with your actual Google Maps embed code. -->
                <div class="w-full h-64 rounded-md overflow-hidden border border-gray-200">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3153.284714652285!2d144.96305731531238!3d-37.81725097975199!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6ad642b322a30b21%3A0x5045675218d6e32d!2sMelbourne%20VIC%2C%20Australia!5e0!3m2!1sen!2sus!4v1612140000000!5m2!1sen!2sus" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
                <div class="flex justify-center space-x-4 mt-6">
                    <a href="https://waze.com/ul?q=The+Grand+Garden+Venue,123+Wedding+Lane,Anytown,State+12345" target="_blank" class="flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 transition-colors duration-300">
                        <span class="mr-2 text-lg">üöó</span> Waze
                    </a>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=The+Grand+Garden+Venue,123+Wedding+Lane,Anytown,State+12345" target="_blank" class="flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-500 hover:bg-green-600 transition-colors duration-300">
                        <span class="mr-2 text-lg">üó∫Ô∏è</span> Google Maps
                    </a>
                </div>
            </div>
        </div>

        <!-- Contact Section (Hidden to be used in the modal) -->
        <div id="contact-content" class="hidden">
            <h3 class="font-playfair text-3xl font-bold text-center mb-6">Contact Us</h3>
            <div class="bg-white p-6 rounded-xl shadow-md text-center space-y-4">
                <p class="text-lg">For any inquiries or assistance, feel free to contact us directly:</p>
                
                <!-- Contact for Emma -->
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <span class="text-lg font-semibold">Emma</span>
                    <div class="flex space-x-2">
                        <!-- WhatsApp Link -->
                        <a href="https://wa.me/1234567890" target="_blank" class="p-2 rounded-full bg-green-500 text-white hover:bg-green-600 transition-colors duration-200">
                            <span class="text-xl">üí¨</span>
                        </a>
                        <!-- Phone Call Link -->
                        <a href="tel:+1234567890" class="p-2 rounded-full bg-rose-500 text-white hover:bg-rose-600 transition-colors duration-200">
                            <span class="text-xl">üìû</span>
                        </a>
                    </div>
                </div>

                <!-- Contact for Liam -->
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <span class="text-lg font-semibold">Liam</span>
                    <div class="flex space-x-2">
                        <!-- WhatsApp Link -->
                        <a href="https://wa.me/1234567890" target="_blank" class="p-2 rounded-full bg-green-500 text-white hover:bg-green-600 transition-colors duration-200">
                            <span class="text-xl">üí¨</span>
                        </a>
                        <!-- Phone Call Link -->
                        <a href="tel:+1234567890" class="p-2 rounded-full bg-rose-500 text-white hover:bg-rose-600 transition-colors duration-200">
                            <span class="text-xl">üìû</span>
                        </a>
                    </div>
                </div>

            </div>
        </div>

        <!-- Money Gift Section (Hidden to be used in the modal) -->
        <div id="money-gift-content" class="hidden">
            <h3 class="font-playfair text-3xl font-bold text-center mb-6">Gift Registry</h3>
            <div class="bg-white p-6 rounded-xl shadow-md text-center">
                <p class="mb-4">Your presence is the only gift we need! However, if you would like to contribute, a money gift would be greatly appreciated as we start our new life together.</p>
                <!-- Placeholder for a QR code image. You can replace this with an actual QR code to a payment service. -->
                <img src="https://placehold.co/200x200?text=QR+Code" alt="Money Gift QR Code" class="mx-auto my-4 rounded-lg shadow-md">
                <p class="text-sm text-gray-500">Scan this QR code to contribute.</p>
            </div>
        </div>
    </div>

    <!--
      Fixed Navigation Bar.
      This will always be visible at the bottom of the screen.
      It uses flexbox for horizontal alignment and anchors to scroll to sections.
      We've added 'hidden' and 'opacity-0' classes to hide it on initial load.
    -->
    <nav id="nav-bar" class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t-2 border-gray-100 p-2 z-50 hidden opacity-0">
        <div class="flex justify-around items-center h-full">
            <a href="#rsvp-section" id="rsvp-button" class="flex-1 text-center py-2 px-1 text-gray-500 hover:text-rose-500 transition-colors duration-300">
                <span class="block text-2xl">üéÅ</span>
                <span class="block text-xs mt-1">RSVP</span>
            </a>
            <a href="#guestbook-section" id="guestbook-button" class="flex-1 text-center py-2 px-1 text-gray-500 hover:text-rose-500 transition-colors duration-300">
                <span class="block text-2xl">üìù</span>
                <span class="block text-xs mt-1">Guestbook</span>
            </a>
            <a href="#" id="location-button" class="flex-1 text-center py-2 px-1 text-gray-500 hover:text-rose-500 transition-colors duration-300">
                <span class="block text-2xl">üìç</span>
                <span class="block text-xs mt-1">Location</span>
            </a>
            <a href="#" id="contact-button" class="flex-1 text-center py-2 px-1 text-gray-500 hover:text-rose-500 transition-colors duration-300">
                <span class="block text-2xl">üìû</span>
                <span class="block text-xs mt-1">Contact</span>
            </a>
            <a href="#" id="money-gift-button" class="flex-1 text-center py-2 px-1 text-gray-500 hover:text-rose-500 transition-colors duration-300">
                <span class="block text-2xl">üí∞</span>
                <span class="block text-xs mt-1">Gift</span>
            </a>
            <!-- New refresh button added here -->
            <a href="#" id="refresh-button" class="flex-1 text-center py-2 px-1 text-gray-500 hover:text-rose-500 transition-colors duration-300">
                <span class="block text-2xl">üîÑ</span>
                <span class="block text-xs mt-1">Refresh</span>
            </a>
        </div>
    </nav>
    
    <!--
      Modal Overlay & Content
      This section is the new pop-up window that will be shown when
      a navigation button is clicked. It is hidden by default.
    -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-content w-full sm:max-w-md">
            <div class="flex justify-end">
                <button id="close-modal-button" class="text-gray-500 hover:text-gray-900 text-2xl font-bold">&times;</button>
            </div>
            <div id="modal-body" class="pt-4">
                <!-- Content will be dynamically inserted here by JavaScript -->
            </div>
        </div>
    </div>
    
    <!--
      Error/Success message box that can be reused for any action.
      It is hidden by default and will be shown/hidden as needed.
    -->
    <div id="general-message-box" class="message-box fixed top-4 left-1/2 -translate-x-1/2 w-11/12 sm:max-w-md rounded-lg shadow-lg z-[101]"></div>
    
    <!--
      Firebase Imports
      These are the necessary scripts to connect to a Firestore database.
      We'll import the core app, auth, and firestore modules.
    -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Reusable Message Box Function ---
        // This function is now in the global scope of the script to be accessible everywhere.
        const messageBox = document.getElementById('general-message-box');
        function showMessage(type, text, duration = 5000) {
            messageBox.textContent = text;
            messageBox.classList.remove('success', 'error', 'hidden');
            messageBox.classList.add('visible', type);
            setTimeout(() => {
                messageBox.classList.remove('visible');
                messageBox.classList.add('hidden');
            }, duration);
        }
        
        // Wrap the entire application logic in a 'DOMContentLoaded' event listener.
        // This ensures that the code only runs after the entire HTML document has
        // been loaded and parsed by the browser, preventing errors where a script
        // tries to access an element that doesn't exist yet.
        document.addEventListener('DOMContentLoaded', async () => {

            // --- Firebase Setup & Authentication ---
            
            // This is the Firebase configuration you provided.
            // It is used to initialize your project.
            const firebaseConfig = {
                apiKey: "AIzaSyA-AWZstpEXLlNdIcxBacz3CqgvHuO7WTk",
                authDomain: "kadkahwinapp.firebaseapp.com",
                projectId: "kadkahwinapp",
                storageBucket: "kadkahwinapp.firebasestorage.app",
                messagingSenderId: "379804424047",
                appId: "1:379804424047:web:aee85c708ce1a0bc39ba9a",
                measurementId: "G-GC67C5YW8H"
            };
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

            // Initialize Firebase App and Services
            let app;
            let db;
            let auth;
            let userId;
            
            try {
                // Initialize the Firebase app with the provided config.
                app = initializeApp(firebaseConfig);
                // Get the Firestore and Auth service instances.
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Sign in anonymously or with a custom token.
                // This is where the authentication process begins.
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser.uid;
                console.log("Successfully signed in with user ID:", userId);

                // --- Firestore Collection References ---
                // The collections are scoped to the app ID to prevent conflicts.
                const rsvpCollectionRef = collection(db, `artifacts/${appId}/public/data/rsvps`);
                const guestbookCollectionRef = collection(db, `artifacts/${appId}/public/data/guestbook-entries`);

                // --- Intro Screen & Main Content Toggle ---
                const openButton = document.getElementById('open-button');
                const introScreen = document.getElementById('intro-screen');
                const mainContent = document.getElementById('main-content');
                const navBar = document.getElementById('nav-bar');

                openButton.addEventListener('click', () => {
                    // Add a class to fade out the intro screen and make it unclickable.
                    introScreen.classList.add('fade-out');

                    // Wait for the fade-out transition to complete before showing the main content.
                    setTimeout(() => {
                        introScreen.classList.add('hidden'); // Fully hide the intro screen

                        // Reveal the main content and navigation bar at the same time.
                        mainContent.classList.remove('hidden');
                        navBar.classList.remove('hidden');

                        setTimeout(() => {
                            mainContent.classList.remove('opacity-0'); // Fade in the main content
                            navBar.classList.remove('opacity-0'); // Fade in the navigation bar
                            
                            // Start the countdown timer as soon as the main content is visible
                            startCountdown();
                        }, 50); // Small delay to ensure the `hidden` class is removed first.
                    }, 1000); // This duration should match the CSS transition duration.
                });

                // --- Image Carousel ---
                let slideIndex = 0;
                const slides = document.querySelectorAll('.carousel-item');
                const dots = document.querySelectorAll('.dot');
                const totalSlides = slides.length;

                // Function to show a specific slide.
                function showSlides(n) {
                    // Hide all slides and remove the active dot class.
                    slides.forEach(slide => slide.classList.remove('active'));
                    dots.forEach(dot => dot.classList.remove('opacity-100'));
                    dots.forEach(dot => dot.classList.add('opacity-50'));

                    // Set the new slide and dot to active.
                    slides[n].classList.add('active');
                    dots[n].classList.remove('opacity-50');
                    dots[n].classList.add('opacity-100');
                }

                // Function to move to the next slide automatically.
                function nextSlide() {
                    slideIndex = (slideIndex + 1) % totalSlides;
                    showSlides(slideIndex);
                }

                // Function to manually set the slide via a dot click.
                function currentSlide(n) {
                    slideIndex = n;
                    showSlides(slideIndex);
                }

                // Start the automatic slideshow.
                setInterval(nextSlide, 5000); // Change image every 5 seconds.
                showSlides(slideIndex); // Show the first slide on load.


                // --- Modal Logic ---
                const modalOverlay = document.getElementById('modal-overlay');
                const modalBody = document.getElementById('modal-body');
                const closeModalButton = document.getElementById('close-modal-button');
                const navButtons = document.querySelectorAll('#nav-bar a');

                // Function to open the modal with specific content
                function openModal(contentElement) {
                    // Clone the content to display it in the modal.
                    const clonedContent = contentElement.cloneNode(true);
                    // Remove the 'hidden' class so it's visible.
                    clonedContent.classList.remove('hidden'); 
                    modalBody.innerHTML = ''; // Clear previous content.
                    modalBody.appendChild(clonedContent); // Add the new content.
                    modalOverlay.classList.add('active'); // Show the modal overlay.

                    // If the modal content is the RSVP form, re-attach the event listener.
                    if (contentElement.id === 'rsvp-form-modal-content') {
                        const rsvpForm = clonedContent.querySelector('#rsvp-form');
                        if (rsvpForm) {
                            rsvpForm.addEventListener('submit', handleRsvpSubmit);
                        }
                    }
                    
                    // If the modal content is the Guestbook form, re-attach the event listener.
                    if (contentElement.id === 'guestbook-form-content') {
                        const guestbookForm = clonedContent.querySelector('#guestbook-form');
                        if (guestbookForm) {
                            guestbookForm.addEventListener('submit', handleGuestbookSubmit);
                        }
                    }
                }

                // Function to close the modal
                function closeModal() {
                    modalOverlay.classList.remove('active');
                }
                
                // Attach event listeners for all buttons that should open a modal.
                navButtons.forEach(button => {
                    // The RSVP and Guestbook buttons now scroll, so they are handled differently.
                    if (button.id !== 'rsvp-button' && button.id !== 'guestbook-button') {
                        button.addEventListener('click', (e) => {
                            e.preventDefault(); // Prevent the default link behavior.
                            const sectionId = button.id.replace('-button', ''); // e.g., 'location'
                            
                            // The 'refresh-button' is handled differently
                            if (sectionId === 'refresh') {
                                location.reload();
                                return;
                            }
                            const contentElement = document.getElementById(`${sectionId}-content`);
                            openModal(contentElement);
                        });
                    }
                });
                
                // Add a separate listener for the new RSVP button in the main page content.
                const openRsvpButton = document.getElementById('open-rsvp-button');
                openRsvpButton.addEventListener('click', () => {
                    const rsvpFormContent = document.getElementById('rsvp-form-modal-content');
                    openModal(rsvpFormContent);
                });
                
                // Add listener for the new Guestbook button on the main page.
                const openGuestbookFormButton = document.getElementById('open-guestbook-form-button');
                openGuestbookFormButton.addEventListener('click', () => {
                    const guestbookFormContent = document.getElementById('guestbook-form-content');
                    openModal(guestbookFormContent);
                });

                // Close modal when the close button is clicked.
                closeModalButton.addEventListener('click', closeModal);

                // Close modal when the overlay is clicked, but not the content inside.
                modalOverlay.addEventListener('click', (e) => {
                    if (e.target.id === 'modal-overlay') {
                        closeModal();
                    }
                });


                // --- RSVP Form Submission (Updated for Firestore) ---
                async function handleRsvpSubmit(e) {
                    e.preventDefault(); // Prevent the default form submission behavior.
                    const rsvpForm = e.target;
                    const formData = new FormData(rsvpForm);
                    const data = Object.fromEntries(formData.entries());

                    try {
                        // Save the RSVP data to a public Firestore collection.
                        await addDoc(rsvpCollectionRef, {
                            ...data, // Spread the form data
                            timestamp: new Date() // Add a timestamp for when the RSVP was submitted
                        });

                        console.log('RSVP Data saved successfully!', data);
                        showMessage('success', 'Thank you for your RSVP! We can\'t wait to see you.');
                        closeModal();

                        rsvpForm.reset();

                    } catch (error) {
                        console.error('Error saving RSVP data:', error);
                        showMessage('error', 'There was an error submitting your RSVP. Please try again.');
                    }
                };
                
                // --- Guestbook Logic ---
                const guestbookEntriesContainer = document.getElementById('guestbook-entries');

                // Set up a real-time listener for the guestbook entries.
                // This will automatically update the page whenever a new message is submitted.
                onSnapshot(guestbookCollectionRef, (snapshot) => {
                    const entries = [];
                    snapshot.forEach(doc => {
                        entries.push(doc.data());
                    });
                    renderGuestbookEntries(entries);
                }, (error) => {
                    console.error("Error fetching guestbook entries: ", error);
                    showMessage('error', 'Failed to load guestbook messages.');
                });
                
                // Function to render the guestbook entries in the DOM.
                function renderGuestbookEntries(entries) {
                    // Clear existing entries.
                    guestbookEntriesContainer.innerHTML = '';
                    
                    // If there are no entries, show a placeholder message.
                    if (entries.length === 0) {
                        guestbookEntriesContainer.innerHTML = '<p class="text-center text-gray-500">Be the first to leave a message!</p>';
                        return;
                    }

                    // Sort entries by timestamp in descending order so the newest are on top.
                    entries.sort((a, b) => b.timestamp.toDate() - a.timestamp.toDate());

                    // Create and append a card for each entry.
                    entries.forEach(entry => {
                        const entryCard = document.createElement('div');
                        entryCard.classList.add('bg-gray-50', 'p-4', 'rounded-lg', 'shadow-sm');
                        entryCard.innerHTML = `
                            <p class="font-bold text-lg text-rose-500">${entry.name}</p>
                            <p class="text-gray-700 mt-2">${entry.message}</p>
                        `;
                        guestbookEntriesContainer.appendChild(entryCard);
                    });
                }

                // Handle guestbook form submission.
                async function handleGuestbookSubmit(e) {
                    e.preventDefault();
                    const guestbookForm = e.target;
                    const formData = new FormData(guestbookForm);
                    const data = Object.fromEntries(formData.entries());

                    try {
                        await addDoc(guestbookCollectionRef, {
                            ...data,
                            timestamp: new Date()
                        });

                        console.log('Guestbook message saved successfully!', data);
                        showMessage('success', 'Thank you for your lovely message!');
                        closeModal(); // Close the modal after successful submission.

                        guestbookForm.reset();

                    } catch (error) {
                        console.error('Error saving guestbook message:', error);
                        showMessage('error', 'There was an error saving your message. Please try again.');
                    }
                }


                // --- Countdown Timer (Updated to be on the main page) ---
                const weddingDate = new Date('December 28, 2025 16:00:00').getTime();
                const countdownEl = document.getElementById('countdown-timer');
                
                // Function to update the countdown. It now takes the element to update.
                function updateCountdown() {
                    const now = new Date().getTime();
                    const distance = weddingDate - now;

                    // If the countdown is over, display a message.
                    if (distance < 0) {
                        clearInterval(countdownInterval);
                        countdownEl.innerHTML = `<span class="text-4xl text-rose-500 font-bold">The day is here!</span>`;
                        return;
                    }

                    // Calculate time units.
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    // Update the countdown element's HTML.
                    countdownEl.innerHTML = `
                        <div class="flex flex-col items-center">
                            <span class="text-4xl sm:text-5xl">${days}</span>
                            <span class="text-xs sm:text-sm font-normal">DAYS</span>
                        </div>
                        <span class="text-3xl sm:text-4xl">:</span>
                        <div class="flex flex-col items-center">
                            <span class="text-4xl sm:text-5xl">${hours}</span>
                            <span class="text-xs sm:text-sm font-normal">HOURS</span>
                        </div>
                        <span class="text-3xl sm:text-4xl">:</span>
                        <div class="flex flex-col items-center">
                            <span class="text-4xl sm:text-5xl">${minutes}</span>
                            <span class="text-xs sm:text-sm font-normal">MINUTES</span>
                        </div>
                        <span class="text-3xl sm:text-4xl">:</span>
                        <div class="flex flex-col items-center">
                            <span class="text-4xl sm:text-5xl">${seconds}</span>
                            <span class="text-xs sm:text-sm font-normal">SECONDS</span>
                        </div>
                    `;
                }

                let countdownInterval;
                // This function is now responsible for starting the continuous countdown.
                function startCountdown() {
                    // Call the update function immediately and then every second.
                    updateCountdown();
                    countdownInterval = setInterval(updateCountdown, 1000);
                }
            } catch (error) {
                console.error("Error during Firebase authentication:", error);
                
                // Show a detailed error message to the user
                const introScreen = document.getElementById('intro-screen');
                introScreen.innerHTML = `
                    <div class="text-center p-6 bg-red-100 border border-red-400 text-red-700 rounded-lg shadow-lg max-w-sm mx-auto">
                        <h2 class="text-2xl font-bold mb-4">Connection Error</h2>
                        <p class="mb-4">Failed to connect to the database. Please check your Firebase project settings.</p>
                        <p class="text-sm font-semibold">Possible causes:</p>
                        <ul class="text-left text-sm list-disc list-inside mt-2 space-y-1">
                            <li>The \`apiKey\` in \`firebaseConfig\` might be incorrect.</li>
                            <li>"Anonymous Sign-in" is not enabled in your Firebase Authentication settings.</li>
                        </ul>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
